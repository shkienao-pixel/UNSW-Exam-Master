# 03_QA_v0.2.1.md

## QA Verdict
- **Status:** PASS
- **Scope:** Phase 2.2 / v0.2.1 requested DoD A-E

---

## 1. DoD Validation

### A. UI / Course-first flow
- [x] Sidebar upgraded from text collection to course selector + create course form.
- [x] Upload blocked without active course (`select_course_first` warning).
- [x] Upload saves artifacts bound to selected `course_id`.

### B. Generation / Outputs
- [x] Summary/graph/syllabus generation is executed in selected course context.
- [x] Each generation writes `outputs` row with `course_id`, `type`, `scope`, `model`, `status`, `content/path`, `created_at`.
- [x] Outputs tab lists history and supports download.

### C. Flashcards
- [x] Flashcards is independent nav page.
- [x] Deck model supports `vocab` and `mcq`.
- [x] Card generation and review MVP flow available.

### D. Database / Migration safety
- [x] Added SQL migration `002_course_workspace.sql`.
- [x] Existing migration safety logic unchanged (`lock`, `BEGIN IMMEDIATE`, rollback, idempotent rerun).
- [x] Clean migration path verified via `self_check` and schema version checks.

### E. Version / Changelog
- [x] `VERSION` updated to `0.2.1`.
- [x] `CHANGELOG.md` includes `## 0.2.1 - 2026-02-18` with Added/Changed.

---

## 2. Evidence (Commands)

1. Syntax compile:
```powershell
.\.venv\Scripts\python.exe -m py_compile src\app.py src\i18n.py src\services\course_workspace_service.py scripts\self_check.py
```
Result: pass.

2. Stability + migration + CRUD self-check:
```powershell
.\.venv\Scripts\python.exe scripts\self_check.py
```
Result:
```text
self_check: OK
```

3. Migration version/table verification:
```powershell
python - <<PY
from migrations.migrate import migrate_to_latest, latest_migration_version
...
PY
```
Result summary:
- `latest_migration_version= 2`
- `db_schema_version= 2`
- tables include `courses, artifacts, outputs, decks, cards`.

4. Feature trace:
```powershell
rg -n "_render_study_mode|_render_flashcards_page|create_course\(|save_artifact\(|create_output\(|create_deck\(|replace_mcq_cards|replace_vocab_cards" src/app.py src/services/course_workspace_service.py src/migrations/sql/002_course_workspace.sql -S
```
Result: expected hits present.

---

## 3. Manual Repro Paths

1. Sidebar -> create course (code + name) -> select course.
2. Study -> Upload tab: upload PDFs -> verify artifact list appears.
3. Study -> click Build/Refresh Index.
4. Study -> Generate tab: click summary/graph/syllabus -> verify render.
5. Study -> Outputs tab: select historical output -> download.
6. Sidebar nav -> Flashcards:
   - create vocab deck -> generate cards -> review with prev/next.
   - create mcq deck -> generate cards -> reveal answer/explanation.
7. Switch to another course -> verify old course outputs/decks do not leak across selection.

---

## 4. Residual Risks
- LLM quality and output schema quality still depend on model response consistency.
- Manual visual/mobile layout validation still recommended before release tagging.
