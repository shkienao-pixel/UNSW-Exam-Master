"""Simple i18n translation map for UI text."""

from __future__ import annotations

from typing import Final

LANG_MAP: Final[dict[str, dict[str, str]]] = {
    "en": {
        "lang_label": "Language",
        "lang_en": "English",
        "lang_zh": "中文",
        "sidebar_settings": "Settings",
        "api_key": "API Key",
        "api_placeholder": "OpenAI API Key",
        "api_help": "Stored in session only, not persisted.",
        "index_status": "Vector Index Status",
        "indexed_files": "Indexed files",
        "skipped_files": "Skipped files",
        "chunks": "Chunks",
        "download_md": "Download Revision Notes (.md)",
        "download_pdf": "Download Revision Notes (.pdf)",
        "reportlab_hint": "Install `reportlab` to enable PDF export.",
        "save_session": "Save Current Session",
        "about": "About",
        "app_version": "App Version",
        "schema_version": "Schema Version",
        "index_outdated": "Index outdated, please rebuild.",
        "index_details": "Mismatch: {details}",
        "rebuild_now": "Rebuild Index Now",
        "rebuild_need_upload": "Please upload PDFs before rebuilding.",
        "nav": "Navigation",
        "dashboard": "Dashboard",
        "flashcards_nav": "Flashcards",
        "mistakes_nav": "Mistakes",
        "summary_page": "Summary",
        "graph_page": "Revision Mind Map",
        "outline_page": "Outline",
        "quiz_page": "Quiz",
        "coming_soon": "Coming soon.",
        "hero_tagline": "Your AI-native exam workspace for focused revision.",
        "active_course": "Active Course",
        "course_not_selected": "Not selected",
        "course_manage": "Course Management",
        "course_code": "Course Code",
        "course_name": "Course Name",
        "course_create": "Create Course",
        "course_create_success": "Course {code} created.",
        "course_selector": "Course Selector",
        "course_create_first": "Create at least one course before uploading.",
        "select_course_first": "Please create/select a course first.",
        "selected_lang": "Language",
        "selected_collection": "Collection",
        "collection_label": "Collection",
        "collection_help": "Used as the active vector collection for indexing and retrieval.",
        "go_study": "Upload PDFs",
        "start_exam": "Start Exam",
        "continue_study": "Continue Study",
        "continue_study_desc": "Resume Study mode with your latest materials and context.",
        "start_mock_exam": "Start Mock Exam",
        "start_mock_exam_desc": "Open Exam mode for the currently selected collection.",
        "updates": "Updates",
        "open_full_changelog": "Open Full Changelog",
        "hide_full_changelog": "Hide Full Changelog",
        "activity": "Activity",
        "last_index_time": "Last index build",
        "last_export_time": "Last export",
        "last_studied_collection": "Last studied collection",
        "not_available": "Not available yet",
        "empty_activity_tip_1": "Upload PDFs and build index to populate activity.",
        "empty_activity_tip_2": "Generate notes and export once to track export history.",
        "need_help": "Need help?",
        "help_index": "Index outdated -> rebuild",
        "help_migration": "Migration/backups",
        "help_self_check": "Run self_check.py",
        "help_self_check_cmd": "Command: .\\.venv\\Scripts\\python.exe scripts/self_check.py",
        "study_mode": "Study Mode",
        "study_generate_nav": "Study / Generate",
        "study_generate_nav_hint": "Generation pages are grouped under Study mode.",
        "upload_materials": "Upload Materials",
        "upload_pdf": "Upload one or multiple PDFs",
        "upload_help": "Multiple PDF files are supported and indexed into Chroma.",
        "artifacts_saved": "Saved artifacts: {n}",
        "loaded_files": "Loaded {n} file(s), extracted {c} characters.",
        "preview": "Preview (first 700 chars)",
        "build_index": "Build/Refresh Vector Index",
        "enter_api_first": "Please enter API Key in sidebar first.",
        "indexing": "Indexing files into Chroma...",
        "index_ready": "Index ready. indexed={i}, skipped={s}, chunks={c}",
        "generate": "Generate",
        "gen_summary": "Generate Summary",
        "gen_graph": "Generate Knowledge Graph",
        "gen_syllabus": "Generate Syllabus",
        "enter_api": "Please enter API Key.",
        "gen_summary_spinner": "Generating summary...",
        "gen_graph_spinner": "Generating graph...",
        "gen_syllabus_spinner": "Generating syllabus...",
        "generate_scope_picker": "Generation Scope",
        "select_at_least_one_file": "Please select at least one file.",
        "scope_selected_count": "Selected files: {n}",
        "generate_jump_hint": "Use these three buttons to open Outline / Mind Map / Quiz pages.",
        "generate_quiz_scope": "Generate Quiz",
        "generate_recent_jump": "Recent generated outputs (click to open/jump)",
        "open_latest": "Open Latest {name}",
        "no_recent_output": "No output yet",
        "quiz_count": "Quiz Size",
        "scope_set_selector": "Scope Set",
        "scope_set_name": "Scope Set Name",
        "scope_set_create": "Create Scope Set",
        "scope_set_create_success": "Scope set created.",
        "scope_set_current": "Current Scope Set",
        "scope_set_edit_files": "Edit Files In This Scope Set",
        "scope_set_rename_label": "Scope Set Name",
        "scope_set_rename_action": "Rename Scope Set",
        "scope_set_rename_success": "Scope set renamed.",
        "scope_set_rename_disabled_default": "All Materials is system-managed and cannot be renamed.",
        "scope_set_delete_action": "Delete Scope Set",
        "scope_set_delete_confirm": "Delete scope set '{name}'? This action cannot be undone.",
        "scope_set_delete_confirm_btn": "Confirm Delete",
        "scope_set_delete_cancel_btn": "Cancel",
        "scope_set_delete_success": "Scope set deleted.",
        "scope_set_pick_at_least_one": "Please select at least one scope set.",
        "scope_set_selected_sets_count": "Selected scope sets: {n}",
        "scope_set_saved": "Scope set saved.",
        "scope_set_missing": "Scope set not found.",
        "scope_set_all_materials_hint": "All Materials is managed automatically and includes all course files.",
        "translate_question": "Translate This Question",
        "translated_question": "Translated",
        "view_answer_analysis": "View Answer & Analysis",
        "submit_question": "Submit This Question",
        "select_option_before_submit": "Please select one option before submitting.",
        "quiz_correct": "Correct",
        "quiz_wrong": "Incorrect",
        "quiz_result_line": "Your choice: {chosen} | Correct answer: {correct}",
        "answer_en": "Answer (EN)",
        "answer_zh": "Answer (ZH)",
        "explanation_en": "Analysis (EN)",
        "explanation_zh": "Analysis (ZH)",
        "quiz_accuracy": "Accuracy",
        "quiz_accuracy_line": "Correct {correct} / Submitted {submitted} / Total {total} ({pct}%)",
        "translation_call_count": "Translation model calls this session: {n}",
        "mistakes_filter_status": "Status Filter",
        "mistakes_filter_type": "Type Filter",
        "mistakes_count": "Mistake items: {n}",
        "mistakes_review_start": "Review Active Mistakes",
        "mistakes_empty": "No mistakes found for current filter.",
        "mistakes_wrong_count": "Wrong Count",
        "mistakes_last_wrong": "Last Wrong Time",
        "mistakes_mark_mastered": "Mark Mastered",
        "mistakes_delete": "Archive",
        "mistakes_review_title": "Mistakes Review Deck",
        "study_tab_upload": "Upload",
        "study_tab_generate": "Generate",
        "study_tab_outputs": "Outputs",
        "outputs_history": "Outputs History",
        "output_filter": "Filter by type",
        "output_filter_all": "All",
        "output_select": "Select output",
        "outputs_empty": "No outputs yet for this course.",
        "output_scope_count": "Scope files: {n}",
        "output_scope_set_name": "Scope Set",
        "output_scope_files": "Scope File List",
        "output_scope_empty": "No scope file list recorded.",
        "quiz_history_count": "Question count: {n}",
        "output_scope": "Scope",
        "output_model": "Model",
        "output_status": "Status",
        "output_download": "Download Output",
        "upload_or_index_first": "Upload PDFs and/or build index first.",
        "image_analysis": "Slide Screenshot Analysis",
        "upload_image": "Upload screenshot",
        "analyze_image": "Analyze screenshot",
        "chapter_summary": "Chapter Summary",
        "syllabus_default": "Syllabus Checklist",
        "syllabus_framework": "Framework",
        "syllabus_section": "Section",
        "syllabus_objective": "Objective",
        "syllabus_detail": "Detail",
        "progress": "Progress: {done}/{all} ({pct}%)",
        "deck_create": "Create Deck",
        "deck_name": "Deck Name",
        "deck_type": "Deck Type",
        "deck_type_vocab": "Vocab",
        "deck_type_mcq": "MCQ",
        "deck_create_action": "Create Deck",
        "deck_create_success": "Deck created.",
        "deck_empty": "No decks yet for this course.",
        "deck_select": "Select Deck",
        "deck_not_found": "Deck not found.",
        "deck_generate_cards": "Generate Cards for Deck",
        "deck_generate_done": "Generated {n} card(s).",
        "flashcards_generate": "Generate Flashcards",
        "flashcards_deck_size": "Deck Size",
        "flashcards_mix_hint": "Mix ratio: MCQ 60% + Knowledge 40%",
        "flashcards_scope_default": "Flashcards scope: all uploaded files ({n})",
        "flashcards_translate": "Translate This Card",
        "flashcards_translated_front": "Chinese",
        "flashcards_translated_answer": "Answer (ZH)",
        "flashcards_translated_explanation": "Explanation (ZH)",
        "flashcards_submit_required": "Submit this MCQ before moving to next card.",
        "flashcards_known": "Known",
        "flashcards_unknown": "Unknown",
        "flashcards_done": "Deck completed.",
        "flashcards_done_line": "Known: {known} | Unknown: {unknown} | Accuracy: {pct}%",
        "flashcards_attempts": "Generator JSON parse attempts: {n}",
        "cards_empty": "No cards in this deck yet.",
        "review_prev": "Previous",
        "review_next": "Next",
        "review_progress": "Card {current}/{total}",
        "answer_label": "Answer",
        "flashcards": "Flashcards (Active Recall)",
        "extract_flashcards": "Extract Flashcards",
        "extracting_flashcards": "Extracting flashcards...",
        "front": "Front",
        "show_answer": "Show answer",
        "qa": "Q&A with Course Materials",
        "chat_placeholder": "Ask about your uploaded materials",
        "answering": "Answering...",
        "exam_simulator": "Exam Simulator",
        "upload_first": "Please upload materials in Study Mode first.",
        "num_questions": "Number of questions",
        "generate_quiz": "Generate Quiz",
        "generating_quiz": "Generating quiz...",
        "quiz_fail": "Failed to generate quiz. Check API key and indexed materials.",
        "quiz_success": "Generated {n} questions.",
        "practice_test": "Practice Test",
        "choose": "Choose",
        "submit": "Submit",
        "results": "Results",
        "correct": "Q{qid}: Correct",
        "wrong": "Q{qid}: Wrong (your answer: {chosen}; correct: {correct})",
        "explanation": "Explanation",
    },
    "zh": {
        "lang_label": "语言",
        "lang_en": "English",
        "lang_zh": "中文",
        "sidebar_settings": "设置",
        "api_key": "API 密钥",
        "api_placeholder": "OpenAI API Key",
        "api_help": "仅保存在当前会话，不会持久化。",
        "index_status": "向量索引状态",
        "indexed_files": "已索引文件",
        "skipped_files": "已跳过文件",
        "chunks": "分块数",
        "download_md": "下载复习笔记 (.md)",
        "download_pdf": "下载复习笔记 (.pdf)",
        "reportlab_hint": "安装 reportlab 后可导出 PDF。",
        "save_session": "保存当前会话",
        "about": "关于",
        "app_version": "应用版本",
        "schema_version": "数据库版本",
        "index_outdated": "索引已过期，请重建。",
        "index_details": "不匹配项：{details}",
        "rebuild_now": "立即重建索引",
        "rebuild_need_upload": "请先上传 PDF 再重建。",
        "nav": "导航",
        "dashboard": "仪表盘",
        "flashcards_nav": "闪卡",
        "mistakes_nav": "错题库",
        "summary_page": "章节摘要",
        "graph_page": "复习思维导图",
        "outline_page": "复习大纲",
        "quiz_page": "测试题",
        "coming_soon": "即将上线。",
        "hero_tagline": "你的 AI 原生备考工作台，聚焦高效复习与实战演练。",
        "active_course": "当前课程",
        "course_not_selected": "未选择",
        "course_manage": "课程管理",
        "course_code": "课程代码",
        "course_name": "课程名称",
        "course_create": "新建课程",
        "course_create_success": "课程 {code} 创建成功。",
        "course_selector": "课程选择",
        "course_create_first": "请先创建至少一个课程后再上传资料。",
        "select_course_first": "请先创建或选择课程。",
        "selected_lang": "当前语言",
        "selected_collection": "当前索引集合",
        "collection_label": "学习集合",
        "collection_help": "该名称用于当前向量索引和检索范围。",
        "go_study": "去学习页上传",
        "start_exam": "开始模拟考",
        "continue_study": "继续学习",
        "continue_study_desc": "返回学习模式，继续使用最近上传资料。",
        "start_mock_exam": "开始模拟考",
        "start_mock_exam_desc": "基于当前集合直接进入考试模式。",
        "updates": "更新日志",
        "open_full_changelog": "查看完整变更日志",
        "hide_full_changelog": "收起完整变更日志",
        "activity": "活动记录",
        "last_index_time": "上次构建索引",
        "last_export_time": "上次导出",
        "last_studied_collection": "最近学习集合",
        "not_available": "暂无",
        "empty_activity_tip_1": "先上传 PDF 并构建索引，这里会显示最近活动。",
        "empty_activity_tip_2": "生成并导出一次笔记后，可记录导出时间。",
        "need_help": "需要帮助？",
        "help_index": "索引过期 → 重建索引",
        "help_migration": "迁移与备份",
        "help_self_check": "运行 self_check.py",
        "help_self_check_cmd": "命令：.\\.venv\\Scripts\\python.exe scripts/self_check.py",
        "study_mode": "学习模式",
        "study_generate_nav": "学习模式 / 生成",
        "study_generate_nav_hint": "章节摘要/图谱/大纲/测试题归属学习模式下的生成子导航。",
        "upload_materials": "上传资料",
        "upload_pdf": "上传一个或多个 PDF",
        "upload_help": "支持多份 PDF，并写入 Chroma 本地向量库。",
        "artifacts_saved": "已保存资料：{n}",
        "loaded_files": "已加载 {n} 个文件，提取文本 {c} 字符。",
        "preview": "预览（前 700 字符）",
        "build_index": "构建/刷新向量索引",
        "enter_api_first": "请先在侧边栏输入 API Key。",
        "indexing": "正在写入 Chroma 向量索引...",
        "index_ready": "索引完成。新增={i}，跳过={s}，分块={c}",
        "generate": "生成",
        "gen_summary": "生成章节摘要",
        "gen_graph": "生成知识图谱",
        "gen_syllabus": "生成复习大纲",
        "enter_api": "请输入 API Key。",
        "gen_summary_spinner": "正在生成摘要...",
        "gen_graph_spinner": "正在生成图谱...",
        "gen_syllabus_spinner": "正在生成大纲...",
        "generate_scope_picker": "生成范围",
        "select_at_least_one_file": "请选择至少一个文件。",
        "scope_selected_count": "已选文件：{n}",
        "generate_jump_hint": "点击下方三个按钮，进入复习大纲 / 复习思维导图 / 测试题页面。",
        "generate_quiz_scope": "生成测试题",
        "generate_recent_jump": "最近生成记录（可直接查看并跳转）",
        "open_latest": "查看最近{name}",
        "no_recent_output": "暂无记录",
        "quiz_count": "题量",
        "scope_set_selector": "章节集合",
        "scope_set_name": "章节集合名称",
        "scope_set_create": "新建章节集合",
        "scope_set_create_success": "章节集合创建成功。",
        "scope_set_current": "当前章节集合",
        "scope_set_edit_files": "编辑当前章节集合文件",
        "scope_set_rename_label": "章节集合名称",
        "scope_set_rename_action": "重命名章节集合",
        "scope_set_rename_success": "章节集合已重命名。",
        "scope_set_rename_disabled_default": "All Materials 为系统集合，不可重命名。",
        "scope_set_delete_action": "删除章节集合",
        "scope_set_delete_confirm": "确认删除章节集合“{name}”？此操作不可撤销。",
        "scope_set_delete_confirm_btn": "确认删除",
        "scope_set_delete_cancel_btn": "取消",
        "scope_set_delete_success": "章节集合已删除。",
        "scope_set_pick_at_least_one": "请至少勾选一个章节集合。",
        "scope_set_selected_sets_count": "已选章节集合：{n}",
        "scope_set_saved": "章节集合已自动保存。",
        "scope_set_missing": "未找到章节集合。",
        "scope_set_all_materials_hint": "All Materials 为系统自动维护，默认包含课程全部文件。",
        "translate_question": "翻译本题",
        "translated_question": "翻译",
        "view_answer_analysis": "查看答案与解析",
        "submit_question": "提交本题",
        "select_option_before_submit": "请先选择一个选项再提交。",
        "quiz_correct": "回答正确",
        "quiz_wrong": "回答错误",
        "quiz_result_line": "你的选择：{chosen} | 正确答案：{correct}",
        "answer_en": "答案（英文）",
        "answer_zh": "答案（中文）",
        "explanation_en": "解析（英文）",
        "explanation_zh": "解析（中文）",
        "quiz_accuracy": "正确率",
        "quiz_accuracy_line": "答对 {correct} / 已提交 {submitted} / 总题数 {total}（{pct}%）",
        "translation_call_count": "本会话翻译模型调用次数：{n}",
        "mistakes_filter_status": "状态筛选",
        "mistakes_filter_type": "类型筛选",
        "mistakes_count": "错题条目：{n}",
        "mistakes_review_start": "复习活跃错题",
        "mistakes_empty": "当前筛选下暂无错题。",
        "mistakes_wrong_count": "错题次数",
        "mistakes_last_wrong": "最近错题时间",
        "mistakes_mark_mastered": "标记掌握",
        "mistakes_delete": "归档",
        "mistakes_review_title": "错题复习卡组",
        "study_tab_upload": "上传",
        "study_tab_generate": "生成",
        "study_tab_outputs": "输出记录",
        "outputs_history": "历史输出",
        "output_filter": "按类型筛选",
        "output_filter_all": "全部",
        "output_select": "选择输出",
        "outputs_empty": "该课程暂无输出记录。",
        "output_scope_count": "范围文件数：{n}",
        "output_scope_set_name": "章节集合",
        "output_scope_files": "范围文件列表",
        "output_scope_empty": "未记录范围文件。",
        "quiz_history_count": "题目数量：{n}",
        "output_scope": "范围",
        "output_model": "模型",
        "output_status": "状态",
        "output_download": "下载输出",
        "upload_or_index_first": "请先上传 PDF 或先构建索引。",
        "image_analysis": "课件截图分析",
        "upload_image": "上传截图",
        "analyze_image": "分析截图",
        "chapter_summary": "章节摘要",
        "syllabus_default": "复习大纲",
        "syllabus_framework": "框架",
        "syllabus_section": "章节",
        "syllabus_objective": "学习目标",
        "syllabus_detail": "知识点说明",
        "progress": "进度：{done}/{all} ({pct}%)",
        "deck_create": "创建卡组",
        "deck_name": "卡组名称",
        "deck_type": "卡组类型",
        "deck_type_vocab": "术语卡",
        "deck_type_mcq": "选择题卡",
        "deck_create_action": "创建卡组",
        "deck_create_success": "卡组创建成功。",
        "deck_empty": "当前课程还没有卡组。",
        "deck_select": "选择卡组",
        "deck_not_found": "未找到卡组。",
        "deck_generate_cards": "为卡组生成卡片",
        "deck_generate_done": "已生成 {n} 张卡片。",
        "flashcards_generate": "生成闪卡",
        "flashcards_deck_size": "卡片数量",
        "flashcards_mix_hint": "题型比例：选择题 60% + 知识卡 40%",
        "flashcards_scope_default": "闪卡范围：默认全部上传文件（{n}）",
        "flashcards_translate": "翻译此卡",
        "flashcards_translated_front": "中文翻译",
        "flashcards_translated_answer": "答案（中文）",
        "flashcards_translated_explanation": "解析（中文）",
        "flashcards_submit_required": "请先提交本题，再进入下一张。",
        "flashcards_known": "✅ 会",
        "flashcards_unknown": "❌ 不会",
        "flashcards_done": "本套刷卡已完成。",
        "flashcards_done_line": "会：{known} | 不会：{unknown} | 正确率：{pct}%",
        "flashcards_attempts": "生成器 JSON 解析尝试次数：{n}",
        "cards_empty": "该卡组暂无卡片。",
        "review_prev": "上一张",
        "review_next": "下一张",
        "review_progress": "第 {current}/{total} 张",
        "answer_label": "答案",
        "flashcards": "记忆闪卡（主动回忆）",
        "extract_flashcards": "提取闪卡",
        "extracting_flashcards": "正在提取闪卡...",
        "front": "正面",
        "show_answer": "查看答案",
        "qa": "资料问答",
        "chat_placeholder": "基于已上传资料提问",
        "answering": "正在回答...",
        "exam_simulator": "模拟考试",
        "upload_first": "请先在学习模式上传资料。",
        "num_questions": "题目数量",
        "generate_quiz": "生成模拟题",
        "generating_quiz": "正在生成模拟题...",
        "quiz_fail": "题目生成失败，请检查 API Key 或索引状态后重试。",
        "quiz_success": "已生成 {n} 道题。",
        "practice_test": "模拟测试",
        "choose": "请选择",
        "submit": "提交",
        "results": "结果",
        "correct": "第{qid}题：正确",
        "wrong": "第{qid}题：错误（你的答案：{chosen}；正确答案：{correct}）",
        "explanation": "解析",
    },
}


def tr(lang: str, key: str, **kwargs: object) -> str:
    """Translate key by language with English fallback."""
    locale = "zh" if lang == "zh" else "en"
    text = LANG_MAP.get(locale, {}).get(key) or LANG_MAP["en"].get(key) or key
    return text.format(**kwargs) if kwargs else text
