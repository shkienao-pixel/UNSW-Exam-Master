"""Simple i18n translation map for UI text."""

from __future__ import annotations

from typing import Final

LANG_MAP: Final[dict[str, dict[str, str]]] = {
    "en": {
        "lang_label": "Language",
        "lang_en": "English",
        "lang_zh": "中文",
        "sidebar_settings": "Settings",
        "api_key": "API Key",
        "api_placeholder": "OpenAI API Key",
        "api_help": "Stored in session only, not persisted.",
        "index_status": "Vector Index Status",
        "indexed_files": "Indexed files",
        "skipped_files": "Skipped files",
        "chunks": "Chunks",
        "download_md": "Download Revision Notes (.md)",
        "download_pdf": "Download Revision Notes (.pdf)",
        "reportlab_hint": "Install `reportlab` to enable PDF export.",
        "save_session": "Save Current Session",
        "about": "About",
        "app_version": "App Version",
        "schema_version": "Schema Version",
        "index_outdated": "Index outdated, please rebuild.",
        "index_details": "Mismatch: {details}",
        "rebuild_now": "Rebuild Index Now",
        "rebuild_need_upload": "Please upload PDFs before rebuilding.",
        "nav": "Navigation",
        "dashboard": "Dashboard",
        "hero_tagline": "Your AI-native exam workspace for focused revision.",
        "selected_lang": "Language",
        "selected_collection": "Collection",
        "collection_label": "Collection",
        "collection_help": "Used as the active vector collection for indexing and retrieval.",
        "go_study": "Upload PDFs",
        "start_exam": "Start Exam",
        "continue_study": "Continue Study",
        "continue_study_desc": "Resume Study mode with your latest materials and context.",
        "start_mock_exam": "Start Mock Exam",
        "start_mock_exam_desc": "Open Exam mode for the currently selected collection.",
        "updates": "Updates",
        "open_full_changelog": "Open Full Changelog",
        "hide_full_changelog": "Hide Full Changelog",
        "activity": "Activity",
        "last_index_time": "Last index build",
        "last_export_time": "Last export",
        "last_studied_collection": "Last studied collection",
        "not_available": "Not available yet",
        "empty_activity_tip_1": "Upload PDFs and build index to populate activity.",
        "empty_activity_tip_2": "Generate notes and export once to track export history.",
        "need_help": "Need help?",
        "help_index": "Index outdated -> rebuild",
        "help_migration": "Migration/backups",
        "help_self_check": "Run self_check.py",
        "help_self_check_cmd": "Command: .\\.venv\\Scripts\\python.exe scripts/self_check.py",
        "study_mode": "Study Mode",
        "upload_materials": "Upload Materials",
        "upload_pdf": "Upload one or multiple PDFs",
        "upload_help": "Multiple PDF files are supported and indexed into Chroma.",
        "loaded_files": "Loaded {n} file(s), extracted {c} characters.",
        "preview": "Preview (first 700 chars)",
        "build_index": "Build/Refresh Vector Index",
        "enter_api_first": "Please enter API Key in sidebar first.",
        "indexing": "Indexing files into Chroma...",
        "index_ready": "Index ready. indexed={i}, skipped={s}, chunks={c}",
        "generate": "Generate",
        "gen_summary": "Generate Summary",
        "gen_graph": "Generate Knowledge Graph",
        "gen_syllabus": "Generate Syllabus",
        "enter_api": "Please enter API Key.",
        "gen_summary_spinner": "Generating summary...",
        "gen_graph_spinner": "Generating graph...",
        "gen_syllabus_spinner": "Generating syllabus...",
        "image_analysis": "Slide Screenshot Analysis",
        "upload_image": "Upload screenshot",
        "analyze_image": "Analyze screenshot",
        "chapter_summary": "Chapter Summary",
        "syllabus_default": "Syllabus Checklist",
        "progress": "Progress: {done}/{all} ({pct}%)",
        "flashcards": "Flashcards (Active Recall)",
        "extract_flashcards": "Extract Flashcards",
        "extracting_flashcards": "Extracting flashcards...",
        "front": "Front",
        "show_answer": "Show answer",
        "qa": "Q&A with Course Materials",
        "chat_placeholder": "Ask about your uploaded materials",
        "answering": "Answering...",
        "exam_simulator": "Exam Simulator",
        "upload_first": "Please upload materials in Study Mode first.",
        "num_questions": "Number of questions",
        "generate_quiz": "Generate Quiz",
        "generating_quiz": "Generating quiz...",
        "quiz_fail": "Failed to generate quiz. Check API key and indexed materials.",
        "quiz_success": "Generated {n} questions.",
        "practice_test": "Practice Test",
        "choose": "Choose",
        "submit": "Submit",
        "results": "Results",
        "correct": "Q{qid}: Correct",
        "wrong": "Q{qid}: Wrong (your answer: {chosen}; correct: {correct})",
        "explanation": "Explanation",
    },
    "zh": {
        "lang_label": "语言",
        "lang_en": "English",
        "lang_zh": "中文",
        "sidebar_settings": "设置",
        "api_key": "API 密钥",
        "api_placeholder": "OpenAI API Key",
        "api_help": "仅保存在当前会话，不会持久化。",
        "index_status": "向量索引状态",
        "indexed_files": "已索引文件",
        "skipped_files": "已跳过文件",
        "chunks": "分块数",
        "download_md": "下载复习笔记 (.md)",
        "download_pdf": "下载复习笔记 (.pdf)",
        "reportlab_hint": "安装 reportlab 后可导出 PDF。",
        "save_session": "保存当前会话",
        "about": "关于",
        "app_version": "应用版本",
        "schema_version": "数据库版本",
        "index_outdated": "索引已过期，请重建。",
        "index_details": "不匹配项：{details}",
        "rebuild_now": "立即重建索引",
        "rebuild_need_upload": "请先上传 PDF 再重建。",
        "nav": "导航",
        "dashboard": "仪表盘",
        "hero_tagline": "你的 AI 原生备考工作台。",
        "selected_lang": "当前语言",
        "selected_collection": "当前集合",
        "collection_label": "集合",
        "collection_help": "用于当前向量索引与检索的集合名。",
        "go_study": "上传 PDF",
        "start_exam": "开始模拟考试",
        "continue_study": "继续学习",
        "continue_study_desc": "回到学习模式并延续最近资料上下文。",
        "start_mock_exam": "开始模拟考试",
        "start_mock_exam_desc": "使用当前集合进入考试模式。",
        "updates": "更新动态",
        "open_full_changelog": "查看完整变更日志",
        "hide_full_changelog": "收起完整变更日志",
        "activity": "活动记录",
        "last_index_time": "上次构建索引",
        "last_export_time": "上次导出",
        "last_studied_collection": "最近学习集合",
        "not_available": "暂无",
        "empty_activity_tip_1": "先上传 PDF 并构建索引，这里会出现活动记录。",
        "empty_activity_tip_2": "先生成并导出一次笔记，可记录导出时间。",
        "need_help": "需要帮助？",
        "help_index": "索引过期 -> 重建",
        "help_migration": "迁移 / 备份",
        "help_self_check": "运行 self_check.py",
        "help_self_check_cmd": "命令：.\\.venv\\Scripts\\python.exe scripts/self_check.py",
        "study_mode": "学习模式",
        "upload_materials": "上传资料",
        "upload_pdf": "上传一个或多个 PDF",
        "upload_help": "支持多 PDF，并写入 Chroma 向量库。",
        "loaded_files": "已加载 {n} 个文件，提取文本 {c} 字符。",
        "preview": "预览（前 700 字符）",
        "build_index": "构建/刷新向量索引",
        "enter_api_first": "请先在侧边栏输入 API Key。",
        "indexing": "正在写入 Chroma 向量库...",
        "index_ready": "索引完成。新增={i}，跳过={s}，分块={c}",
        "generate": "生成",
        "gen_summary": "生成章节摘要",
        "gen_graph": "生成知识图谱",
        "gen_syllabus": "生成复习大纲",
        "enter_api": "请输入 API Key。",
        "gen_summary_spinner": "正在生成摘要...",
        "gen_graph_spinner": "正在生成图谱...",
        "gen_syllabus_spinner": "正在生成大纲...",
        "image_analysis": "课件截图分析",
        "upload_image": "上传截图",
        "analyze_image": "分析截图",
        "chapter_summary": "章节摘要",
        "syllabus_default": "复习大纲",
        "progress": "进度：{done}/{all} ({pct}%)",
        "flashcards": "记忆闪卡（主动回忆）",
        "extract_flashcards": "提取闪卡",
        "extracting_flashcards": "正在提取闪卡...",
        "front": "正面",
        "show_answer": "查看答案",
        "qa": "资料问答",
        "chat_placeholder": "基于已上传资料提问",
        "answering": "正在回答...",
        "exam_simulator": "模拟考试",
        "upload_first": "请先在学习模式上传资料。",
        "num_questions": "题目数量",
        "generate_quiz": "生成模拟题",
        "generating_quiz": "正在生成模拟题...",
        "quiz_fail": "题目生成失败，请检查 API Key 或索引状态。",
        "quiz_success": "已生成 {n} 道题。",
        "practice_test": "模拟测试",
        "choose": "请选择",
        "submit": "提交",
        "results": "结果",
        "correct": "第{qid}题：正确",
        "wrong": "第{qid}题：错误（你的答案：{chosen}；正确答案：{correct}）",
        "explanation": "解析",
    },
}


def tr(lang: str, key: str, **kwargs: object) -> str:
    """Translate key by language with English fallback."""
    locale = "zh" if lang == "zh" else "en"
    text = LANG_MAP.get(locale, {}).get(key) or LANG_MAP["en"].get(key) or key
    return text.format(**kwargs) if kwargs else text
